<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Simulador Financeiro</title>
  <style>
    body { font-family: sans-serif; max-width: 400px; margin: 2rem auto; padding: 0 1rem; }
    h1 { text-align: center; }
    label { display: block; margin: 1rem 0 0.25rem; }
    input, select, button, textarea { width: 100%; padding: .5rem; font-size: 1rem; }
    .hidden { display: none; }
    .result { margin-top: 1.5rem; background: #f9f9f9; padding: .75rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Simulador Financeiro</h1>

  <label>Pre√ßo √† vista (R$):
    <input id="v0" type="number" step="0.01" placeholder="Ex: 469.90">
  </label>

  <label>Quantidade de parcelas:
    <select id="n_select">
      <option value="">‚Äî selecione ‚Äî</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="11">11</option>
      <option value="12">12</option>
      <option value="other">Outro</option>
    </select>
  </label>

  <label id="label_n_custom" class="hidden">Digite o n√∫mero de parcelas:
    <input id="n_custom" type="number" min="1" placeholder="Ex: 18">
  </label>

  <label>Valor da parcela (R$):
    <input id="p" type="number" step="0.01" placeholder="Ex: 73.42">
  </label>

  <label>Investimento ‚Äì % CDI (atualiza ao carregar):
    <input id="r" type="number" step="0.0001" readonly placeholder="Carregando‚Ä¶">
  </label>

  <button onclick="calc()">Calcular</button>

  <div class="result" id="res"></div>

  <script>
    // Mostrar/ocultar campo ‚ÄúOutro‚Äù
    document.getElementById('n_select').addEventListener('change', function(e) {
      document.getElementById('label_n_custom')
        .classList.toggle('hidden', e.target.value !== 'other');
    });

    // Buscar CDI via BrasilAPI e converter para taxa mensal (~21 dias √∫teis)
    async function fetchCDI() {
      const inputR = document.getElementById('r');
      inputR.value = '';
      inputR.placeholder = 'Carregando‚Ä¶';
      try {
        const resp = await fetch('https://brasilapi.com.br/api/cdi/v1');
        if (!resp.ok) throw new Error('Status ' + resp.status);
        const json = await resp.json();
        const diario = parseFloat(json.valor);
        const mensal = Math.pow(1 + diario, 21) - 1;
        inputR.value = mensal.toFixed(4);
      } catch (err) {
        console.error('Erro ao buscar CDI:', err);
        inputR.value = '';
        inputR.placeholder = 'n√£o dispon√≠vel';
      }
    }
    window.addEventListener('load', fetchCDI);

    // Fun√ß√£o de c√°lculo
    function calc() {
      const V0 = parseFloat(document.getElementById('v0').value);
      let n = document.getElementById('n_select').value;
      if (n === 'other') {
        n = parseInt(document.getElementById('n_custom').value, 10);
      } else {
        n = parseInt(n, 10);
      }
      const P = parseFloat(document.getElementById('p').value);
      const r = parseFloat(document.getElementById('r').value);

      // Valida√ß√£o
      if (isNaN(V0) || !n || isNaN(P) || isNaN(r)) {
        document.getElementById('res').innerHTML =
          '<p style="color:red">Por favor, preencha todos os campos corretamente.</p>';
        return;
      }

      // C√°lculo m√™s a m√™s
      const F = P * n;
      let juros = 0, pago = 0;
      for (let i = 0; i < n; i++) {
        pago += P;
        juros += Math.max(F - pago, 0) * r;
      }
      const CL = F - juros;
      const decisao = CL > V0
        ? 'üëâ Melhor: Pagar √† vista'
        : 'üëâ Melhor: Parcelar e investir';

      // Exibir resultados
      document.getElementById('res').innerHTML =
        `<p>Total financiado: R$ ${F.toFixed(2)}</p>` +
        `<p>Juros totais: R$ ${juros.toFixed(2)}</p>` +
        `<p>Custo l√≠quido: R$ ${CL.toFixed(2)}</p>` +
        `<p><strong>${decisao}</strong></p>`;
    }
  </script>
</body>
</html>
